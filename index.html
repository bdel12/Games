<!DOCTYPE html>
<html>
<head>
    <title>Pacman Game</title>
    <style>
        .game-board {
            font-family: monospace;
            font-size: 20px;
            line-height: 1;
        }
        .cell {
            display: inline-block;
            width: 20px;
            height: 20px;
            text-align: center;
        }
        #status {
            margin: 10px 0;
            font-family: Arial, sans-serif;
        }
    </style>
</head>
<body>
    <div id="status"></div>
    <div id="game-board" class="game-board"></div>

    <script>
        class PacmanGame {
            constructor(width=20, height=10) {
                this.width = width;
                this.height = height;
                this.level = 1;
                this.setupLevel();
                this.setupControls();
            }

            setupLevel() {
                this.score = 0;
                this.gameOver = false;
                this.invincible = false;
                this.invincibleTimer = 0;
                this.totalDots = 0;
                
                this.pacmanPos = [Math.floor(this.height/2), Math.floor(this.width/2)];
                this.ghostPos = [1, 1];
                
                this.board = Array(this.height).fill().map(() => Array(this.width).fill(' '));
                this.placeDots();
                this.placePowerPellets();
            }

            placeDots() {
                for(let i = 0; i < this.height; i++) {
                    for(let j = 0; j < this.width; j++) {
                        if(Math.random() < 0.3) {
                            this.board[i][j] = '.';
                            this.totalDots++;
                        }
                    }
                }
            }

            placePowerPellets() {
                let pelletsPlaced = 0;
                while(pelletsPlaced < 3) {
                    let i = Math.floor(Math.random() * this.height);
                    let j = Math.floor(Math.random() * this.width);
                    if(this.board[i][j] === ' ') {
                        this.board[i][j] = 'O';
                        pelletsPlaced++;
                    }
                }
            }

            draw() {
                const gameBoard = document.getElementById('game-board');
                const status = document.getElementById('status');
                
                status.innerHTML = `Score: ${this.score} | Level: ${this.level}<br>` +
                    (this.invincible ? `INVINCIBLE! ${10 - Math.floor(this.invincibleTimer/10)} seconds left<br>` : '');
                
                let html = '';
                for(let i = 0; i < this.height; i++) {
                    for(let j = 0; j < this.width; j++) {
                        let content = this.board[i][j];
                        if(i === this.pacmanPos[0] && j === this.pacmanPos[1]) {
                            content = 'P';
                        } else if(i === this.ghostPos[0] && j === this.ghostPos[1]) {
                            content = this.invincible ? 'g' : 'G';
                        }
                        html += `<div class="cell">${content}</div>`;
                    }
                    html += '<br>';
                }
                gameBoard.innerHTML = html;
            }

            setupControls() {
                document.addEventListener('keydown', (event) => {
                    switch(event.key) {
                        case 'ArrowUp':
                            this.movePacman('up');
                            break;
                        case 'ArrowDown':
                            this.movePacman('down');
                            break;
                        case 'ArrowLeft':
                            this.movePacman('left');
                            break;
                        case 'ArrowRight':
                            this.movePacman('right');
                            break;
                    }
                });
            }

            movePacman(direction) {
                let newPos = [...this.pacmanPos];
                
                if(direction === 'up' && newPos[0] > 0) {
                    newPos[0] -= 1;
                } else if(direction === 'down' && newPos[0] < this.height - 1) {
                    newPos[0] += 1;
                } else if(direction === 'left' && newPos[1] > 0) {
                    newPos[1] -= 1;
                } else if(direction === 'right' && newPos[1] < this.width - 1) {
                    newPos[1] += 1;
                }
                
                this.pacmanPos = newPos;
                
                if(this.board[this.pacmanPos[0]][this.pacmanPos[1]] === '.') {
                    this.score += 1;
                    this.board[this.pacmanPos[0]][this.pacmanPos[1]] = ' ';
                    this.checkLevelComplete();
                } else if(this.board[this.pacmanPos[0]][this.pacmanPos[1]] === 'O') {
                    this.invincible = true;
                    this.invincibleTimer = 0;
                    this.board[this.pacmanPos[0]][this.pacmanPos[1]] = ' ';
                    this.checkLevelComplete();
                }
            }

            moveGhost() {
                if(Math.random() < 0.5) {  // 50% chance to make a mistake
                    let direction = Math.random() < 0.5 ? 'horizontal' : 'vertical';
                    if(direction === 'horizontal') {
                        this.ghostPos[1] += Math.random() < 0.5 ? -1 : 1;
                    } else {
                        this.ghostPos[0] += Math.random() < 0.5 ? -1 : 1;
                    }
                    
                    // Keep ghost within bounds
                    this.ghostPos[0] = Math.max(0, Math.min(this.ghostPos[0], this.height - 1));
                    this.ghostPos[1] = Math.max(0, Math.min(this.ghostPos[1], this.width - 1));
                } else {
                    // Move towards pacman
                    if(Math.abs(this.ghostPos[0] - this.pacmanPos[0]) > Math.abs(this.ghostPos[1] - this.pacmanPos[1])) {
                        this.ghostPos[0] += this.ghostPos[0] < this.pacmanPos[0] ? 1 : -1;
                    } else {
                        this.ghostPos[1] += this.ghostPos[1] < this.pacmanPos[1] ? 1 : -1;
                    }
                }
            }

            checkCollision() {
                return this.pacmanPos[0] === this.ghostPos[0] && 
                       this.pacmanPos[1] === this.ghostPos[1] && 
                       !this.invincible;
            }

            checkLevelComplete() {
                let remaining = 0;
                for(let row of this.board) {
                    remaining += row.filter(cell => cell === '.' || cell === 'O').length;
                }
                
                if(remaining === 0) {
                    if(this.level < 3) {
                        alert('MOVING LIKE MCDAVID OUT THERE, ONTO THE NEXT LEVEL!');
                        this.level++;
                        this.setupLevel();
                    } else {
                        alert('YOU WIN!');
                        this.gameOver = true;
                    }
                }
            }

            start() {
                this.gameInterval = setInterval(() => {
                    if(this.gameOver) {
                        clearInterval(this.gameInterval);
                        return;
                    }

                    if(this.invincible) {
                        this.invincibleTimer++;
                        if(this.invincibleTimer >= 100) {
                            this.invincible = false;
                        }
                    }

                    // Ghost movement based on level
                    if(this.level === 1 && Math.random() >= 0.5) {
                        this.moveGhost();
                    } else if(this.level === 2 && Math.random() >= 0.75) {
                        this.moveGhost();
                    } else if(this.level === 3) {
                        this.moveGhost();
                    }

                    if(this.checkCollision()) {
                        alert('LEAFS SUCK AND SO DO YOU!');
                        this.gameOver = true;
                    }

                    this.draw();
                }, 100);
            }
        }

        // Start the game
        const game = new PacmanGame();
        game.start();
    </script>
</body>
</html>
